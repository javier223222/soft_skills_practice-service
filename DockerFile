FROM python:3.11.9-slim

ENV PIP_DISABLE_PIP_VERSION_CHECK=1
ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/app/src

WORKDIR /app

# Copiar requirements primero para aprovechar cache de Docker
COPY requirements.txt .

# Crear y activar entorno virtual
RUN python -m venv venv 
RUN /bin/bash -c "source venv/bin/activate && pip install -r requirements.txt"

# Copiar el resto del código
COPY . .

# Exponer el puerto
EXPOSE 8001

# ✅ Usar uvicorn directamente con host 0.0.0.0 para que sea accesible desde fuera del contenedor
CMD ["venv/bin/python", "-m", "uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8001"]